<!doctype html>
<html lang="zh_cn">
<head>
    <meta charset="utf-8">
    <title>^q^</title>
    <link rel="icon" type="image/png" href="./icon.png">

    <style>
        @font-face {
            font-family: Font;
            src: url("./font.ttf");
        }
        * {
            caret-color: transparent;
            font-family: Font;
            cursor: none;
        }
        body {
            background-color: #f0df24;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            font-family: Font;
        }

        video {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }

        h3 {
            font-size: 2em;
        }
        p {
            font-size: 1.1rem;
        }
        a {
            text-decoration: none;
            color: black;
        }

        .dot {
            width: 80px;
            height: 30px;
            border-radius: 10px;
            background: rgba(0, 0, 0, .8);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.2),
                inset 0 0 15px rgba(0, 0, 0, 0.3);
            position: absolute;
            transform: translate(-50%, -50%);
            pointer-events: none;
            transition: 
                transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
                width 0.3s ease,
                height 0.3s ease,
                background 0.3s ease;
            will-change: transform;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 修正后的进度条指示器 */
        .dot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress, 0%);
            background: #928815;
            z-index: -1;
            transition: width 0.1s linear;
        }

        .dot.active {
            width: 100px;
            height: 50px;
            background: rgba(0, 0, 0, 0.3);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .dot:hover {
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .tip, .menu {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            inset: 0;
            font-size: 1em;
            text-align: center;
            color: white;
        }

        .menu {
            position: absolute;
            top: 40px;
            transform: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            min-width: 160px;
            height: 100px;
            z-index: 20;
            display: none;
        }

        .menu-item {
            padding: 5px 10px;
            margin: 2px 0;
            width: 100%;
            text-align: center;
            color: white;
            cursor: pointer;
            border-radius: 3px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .icon {
            font-size: 20px;
            margin-bottom: 5px;
        }

        #fullscreenButton {
            position: fixed;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            opacity: 0;
            z-index: 1000;
        }

        .menu-footer {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 5px;
        }
        
        .instruction-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            max-width: 80%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .instruction-modal button {
            background: #f0df24;
            border: none;
            padding: 8px 15px;
            margin-top: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 99;
            display: none;
        }

        .progress-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            z-index: 10;
            display: none;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: #f0df24;
            border-radius: 5px;
            transition: width 0.1s linear;
        }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false">
    <video id="myVideo" src="./xrtf.mp4" loop></video>

    <div class="dot">
        <p class="tip">
            <span class="icon">播放</span>
        </p>
        <div class="menu" id="menu">
            <div class="menu-item" data-copy="https://v-ctor.lanzout.com/iaBji3372q0h 密码：xrtF">下载<em>（扣1复制链接）</em></div>
            <div class="menu-item" data-copy="contact@example.com">QQ<em>3293275512</em></div>
            <div class="menu-footer">蓝奏云太好用了你们知道吗</div>
        </div>
    </div>
    
    <!-- 进度条 -->
    <div class="overlay" id="overlay"></div>
    
    <div class="instruction-modal" id="instructionModal">
        <h3>说明</h3>
        <p>按菜单键或E键显示菜单</p>
        <p>鼠标点击实现播放/暂停</p>
        <p class="menu-footer">网页作者：floaq_</p>
        <button id="closeInstruction">开始播放^q^</button>
        <button><a href="https://v-ctor.lanzout.com/iaBji3372q0h">下载(.mp4)</a></button>
    </div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <script>
        const dot = document.querySelector('.dot');
        const tip = document.querySelector('.tip');
        const icon = document.querySelector('.icon');
        const menu = document.getElementById('menu');
        const video = document.getElementById('myVideo');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const instructionModal = document.getElementById('instructionModal');
        const closeInstruction = document.getElementById('closeInstruction');
        const overlay = document.getElementById('overlay');
        let isPlaying = false;
        let showProgressTimeout;

        // 更新进度条和.dot进度
        function updateProgress() {
            if (video.duration) {
                const progress = (video.currentTime / video.duration) * 100;
                progressBar.style.width = `${progress}%`;
                // 更新.dot的进度
                dot.style.setProperty('--progress', `${progress}%`);
            }
            requestAnimationFrame(updateProgress);
        }

        function showProgressBar() {
            progressContainer.style.display = 'block';
            clearTimeout(showProgressTimeout);
            showProgressTimeout = setTimeout(() => {
                progressContainer.style.display = 'none';
            }, 2000);
        }

        function disableMouseClicks() {
            overlay.style.display = 'block';
            document.removeEventListener('mousedown', handleMouseDown);
            document.addEventListener('mousedown', handleInstructionClick);
        }
        
        function enableMouseClicks() {
            overlay.style.display = 'none';
            document.addEventListener('mousedown', handleMouseDown);
            document.removeEventListener('mousedown', handleInstructionClick);
        }

        function handleInstructionClick(e) {
            if (e.button === 0) {
                hideInstructions();
            }
        }

        function showInstructions() {
            instructionModal.style.display = 'block';
            disableMouseClicks();
        }
        
        function hideInstructions() {
            instructionModal.style.display = 'none';
            enableMouseClicks();
            video.play();
            icon.textContent = '暂停';
            isPlaying = true;
            updateProgress();
        }

        // 修正后的菜单显示/隐藏函数
        function toggleMenu() {
            if (menu.style.display === 'flex') {
                menu.style.display = 'none';
            } else {
                menu.style.display = 'flex';
            }
        }

        function requestFullScreen() {
            const button = document.getElementById('fullscreenButton');
            button.addEventListener('click', () => {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log('全屏错误:', err);
                    });
                }
            });
            button.click();
        }

        function disableShortcuts(e) {
            if (e.altKey) {
                e.preventDefault();
                return false;
            }

            if (e.key === 'Escape') {
                hideMenu();
                e.preventDefault();
                return false;
            }

            if (e.key === 'F4' || e.key === 'F11') {
                e.preventDefault();
                return false;
            }

            if ((e.altKey && e.key === 'F4') || (e.metaKey && e.key === 'w')) {
                e.preventDefault();
                return false;
            }

            // 修正后的E键和菜单键判断
            if (e.key === 'e' || e.key === 'E' || e.key === 'ContextMenu') {
                toggleMenu();
                e.preventDefault();
            }

            if (menu.style.display === 'flex') {
                if (e.key === '1') {
                    navigator.clipboard.writeText(document.querySelector('[data-copy="https://v-ctor.lanzout.com/iaBji3372q0h 密码:屠夫"]').dataset.copy);
                }
            }
        }

        function moveDot(e) {
            requestAnimationFrame(() => {
                dot.style.transform = `translate(${e.clientX}px, ${e.clientY}px) rotate(0deg)`;
            });
            showProgressBar();
        }

        function handleMouseDown(e) {
            if (e.button !== 0) return;
            dot.classList.add('active');
            tip.classList.add('active');

            if (isPlaying) {
                video.pause();
                icon.textContent = '继续';
            } else {
                video.play();
                icon.textContent = '暂停';
                updateProgress();
            }
            isPlaying = !isPlaying;
            showProgressBar();
        }

        function handleMouseUp() {
            dot.classList.remove('active');
            tip.classList.remove('active');
        }

        function handleWheel(e) {
            e.preventDefault();
            let volume = video.volume;
            if (e.deltaY < 0) {
                volume = Math.min(volume + 0.1, 1.0);
            } else {
                volume = Math.max(volume - 0.1, 0);
            }
            video.volume = volume;
            showProgressBar();
        }

        function handleProgressClick(e) {
            const rect = progressContainer.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            video.currentTime = pos * video.duration;
            showProgressBar();
        }

        // 添加右键菜单事件监听
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            toggleMenu();
        });

        document.addEventListener('mousemove', moveDot);
        document.addEventListener('mousedown', handleMouseDown);
        document.addEventListener('mouseup', handleMouseUp);
        document.addEventListener('wheel', handleWheel, { passive: false });
        document.addEventListener('keydown', disableShortcuts);
        progressContainer.addEventListener('click', handleProgressClick);

        document.addEventListener('click', (e) => {
            if (!menu.contains(e.target)) {
                menu.style.display = 'none';
            }
        });
        
        closeInstruction.addEventListener('click', hideInstructions);

        window.addEventListener('load', () => {
            moveDot({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            video.volume = 1.0;
            requestFullScreen();
            showInstructions();
        });
    </script>
</body>

</html>
